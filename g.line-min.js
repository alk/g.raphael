/*
 * g.Raphael 0.4 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.linechart=function(K,J,a,c,s,r,D){function C(y,ab){var x=y.length/ab,X=0,i=x,aa=0,Y=[];while(X<y.length){i--;if(i<0){aa+=y[X]*(1+i);Y.push(aa/x);aa=y[X++]*-i;i+=x}else{aa+=y[X++]}}return Y}D=D||{};if(!this.raphael.is(s[0],"array")){s=[s]}if(!this.raphael.is(r[0],"array")){r=[r]}function z(){for(var x=0;x<arguments.length;x++){var j=arguments[x];if(j!==undefined){return j}}}var P=Array.prototype.concat.apply([],s),N=Array.prototype.concat.apply([],r),o=this.g.snapEnds(z(D.minX,Math.min.apply(Math,P)),z(D.maxX,Math.max.apply(Math,P)),s[0].length-1),v=o.from,h=o.to,l=D.gutter||10,Q=(a-l*2)/(h-v),H=this.g.snapEnds(z(D.minY,Math.min.apply(Math,N)),z(D.maxY,Math.max.apply(Math,N)),r[0].length-1),u=H.from,g=H.to,O=(c-l*2)/(g-u),t=Math.max(s[0].length,r[0].length),n=D.symbol||"",L=D.colors||Raphael.fn.g.colors,I=this,p=null,k=null,W=this.set(),M=[];for(var V=0,F=r.length;V<F;V++){t=Math.max(t,r[V].length)}var Z=this.set();for(var V=0,F=r.length;V<F;V++){if(D.shade){Z.push(this.path().attr({stroke:"none",fill:L[V],opacity:D.nostroke?1:0.3}))}if(r[V].length>a-2*l){r[V]=C(r[V],a-2*l);t=a-2*l}if(s[V]&&s[V].length>a-2*l){s[V]=C(s[V],a-2*l)}}var w=this.set();if(D.axis){var f=(D.axis+"").split(/[,\s]+/);+f[0]&&w.push(this.g.axis(K+l,J+l,a-2*l,v,h,D.axisxstep||Math.floor((a-2*l)/20),2));+f[1]&&w.push(this.g.axis(K+a-l,J+c-l,c-2*l,u,g,D.axisystep||Math.floor((c-2*l)/20),3));+f[2]&&w.push(this.g.axis(K+l,J+c-l,a-2*l,v,h,D.axisxstep||Math.floor((a-2*l)/20),0));+f[3]&&w.push(this.g.axis(K+l,J+c-l,c-2*l,u,g,D.axisystep||Math.floor((c-2*l)/20),1))}function T(i){return K+l+(i-v)*Q}function R(i){return J+c-l-(i-u)*O}var G=this.set(),S=this.set(),m;for(var V=0,F=r.length;V<F;V++){if(!D.nostroke){G.push(m=this.path().attr({stroke:L[V],"stroke-width":D.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":D.dash||""}))}var b=this.raphael.is(n,"array")?n[V]:n,A=this.set();M=[];for(var U=0,q=r[V].length;U<q;U++){var e=T((s[V]||s[0])[U]);var d=R(r[V][U]);(Raphael.is(b,"array")?b[U]:b)&&A.push(this.g[Raphael.fn.g.markers[this.raphael.is(b,"array")?b[U]:b]](e,d,(D.width||2)*3).attr({fill:L[V],stroke:"none"}));M=M.concat([U?"L":"M",e,d])}S.push(A);if(D.shade){Z[V].attr({path:M.concat(["L",e,J+c-l,"L",K+l+((s[V]||s[0])[0]-v)*Q,J+c-l,"z"]).join(",")})}!D.nostroke&&m.attr({path:M.join(",")})}function E(ah){var ae=[];for(var af=0,aj=s.length;af<aj;af++){ae=ae.concat(s[af])}ae.sort();var ak=[],ab=[];for(var af=0,aj=ae.length;af<aj;af++){ae[af]!=ae[af-1]&&ak.push(ae[af])&&ab.push(K+l+(ae[af]-v)*Q)}ae=ak;aj=ae.length;var aa=ah||I.set();for(var af=0;af<aj;af++){var Y=ab[af]-(ab[af]-(ab[af-1]||K))/2,ai=((ab[af+1]||K+a)-ab[af])/2+(ab[af]-(ab[af-1]||K))/2,x;ah?(x={}):aa.push(x=I.rect(Y-1,J,Math.max(ai+1,1),c).attr({stroke:"none",fill:"#000",opacity:0}));x.values=[];x.symbols=I.set();x.y=[];x.x=ab[af];x.axis=ae[af];for(var ad=0,ag=r.length;ad<ag;ad++){ak=s[ad]||s[0];for(var ac=0,y=ak.length;ac<y;ac++){if(ak[ac]==ae[af]){x.values.push(r[ad][ac]);x.y.push(J+c-l-(r[ad][ac]-u)*O);x.symbols.push(W.symbols[ad][ac])}}}ah&&ah.call(x)}!ah&&(p=aa)}function B(af){var ab=af||I.set(),x;for(var ad=0,ah=r.length;ad<ah;ad++){for(var ac=0,ae=r[ad].length;ac<ae;ac++){var aa=K+l+((s[ad]||s[0])[ac]-v)*Q,ag=K+l+((s[ad]||s[0])[ac?ac-1:1]-v)*Q,y=J+c-l-(r[ad][ac]-u)*O;af?(x={}):ab.push(x=I.circle(aa,y,Math.abs(ag-aa)/2).attr({stroke:"none",fill:"#000",opacity:0}));x.x=aa;x.y=y;x.value=r[ad][ac];x.line=W.lines[ad];x.shade=W.shades[ad];x.symbol=W.symbols[ad][ac];x.symbols=W.symbols[ad];x.axis=(s[ad]||s[0])[ac];af&&af.call(x)}}!af&&(k=ab)}W.push(G,Z,S,w,p,k);W.lines=G;W.shades=Z;W.symbols=S;W.axis=w;W.hoverColumn=function(j,i){!p&&E();p.mouseover(j).mouseout(i);return this};W.clickColumn=function(i){!p&&E();p.click(i);return this};W.hrefColumn=function(Y){var aa=I.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof Y=="object"){for(var j in Y){for(var y=0,X=p.length;y<X;y++){if(p[y].axis==j){p[y].attr("href",Y[j])}}}}!p&&E();for(var y=0,X=aa.length;y<X;y++){p[y]&&p[y].attr("href",aa[y])}return this};W.hover=function(j,i){!k&&B();k.mouseover(j).mouseout(i);return this};W.click=function(i){!k&&B();k.click(i);return this};W.each=function(i){B(i);return this};W.eachColumn=function(i){E(i);return this};if(D.hook){D.hook({paper:this,transformX:T,transformY:R,minx:v,maxx:h,miny:u,maxy:g,add:function(i){W.push(i)}})}return W};